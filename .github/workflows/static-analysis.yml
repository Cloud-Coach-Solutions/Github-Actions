name: Static Analysis
on:
    workflow_call:
        inputs:
            config-path:
                required: true
                type: string
        secrets:
            token:
                required: true

jobs:
    analyze:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v3
              with:
                  fetch-depth: 0

            - name: Install SFDX CLI and Scanner
              run: |
                  npm install sfdx-cli -g
                  sfdx plugins:install @salesforce/sfdx-scanner

            - name: Run SFDX Scanner - Report findings as comments
              uses: mitchspano/sfdx-scan-pull-request@v0.1.15
              with:
                  pmdconfig: .github/workflows/pmd-rules.xml
                  severity-threshold: 4
              env:
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
